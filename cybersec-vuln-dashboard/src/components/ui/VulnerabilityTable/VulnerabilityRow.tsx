import { TableRow, TableCell, Typography, Chip } from '@mui/material';
import type { Vulnerability } from '../../../services/api';
import { SEVERITY_COLORS } from '../../../utils/severityConfig';
import type { SeverityLevel } from '../../../types/vulnerability';

interface VulnerabilityRowProps {
  vulnerability: Vulnerability;
  index: number;
}

const getSeverityColor = (severity: string): string => {
  return SEVERITY_COLORS[severity as SeverityLevel] || '#666';
};

const formatDate = (dateString?: Date): string => {
  if (!dateString) return 'N/A';
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
};

export const VulnerabilityRow = ({ vulnerability, index }: VulnerabilityRowProps) => {
  return (
    <TableRow
      hover
      className="vulnerability-table__row"
      sx={{
        backgroundColor: index % 2 === 0 ? 'transparent' : 'rgba(255, 255, 255, 0.02)',
        '&:hover': {
          backgroundColor: 'rgba(255, 255, 255, 0.08)',
        },
      }}
    >
      <TableCell sx={{ py: 2.5, px: 2 }}>
        <Typography variant="body1" fontWeight={600} sx={{ fontSize: '0.9rem', color: '#64b5f6' }}>
          {vulnerability.cve}
        </Typography>
      </TableCell>

      <TableCell sx={{ py: 2.5, px: 2 }}>
        <Chip
          label={vulnerability.severity.toUpperCase()}
          size="medium"
          sx={{
            backgroundColor: getSeverityColor(vulnerability.severity),
            color: 'white',
            fontWeight: 700,
            fontSize: '0.75rem',
            minWidth: '80px',
          }}
        />
      </TableCell>

      <TableCell align="center" sx={{ py: 2.5, px: 2 }}>
        <Typography variant="body1" fontWeight={600} sx={{ fontSize: '0.9rem' }}>
          {vulnerability.cvss || 'N/A'}
        </Typography>
      </TableCell>

      <TableCell sx={{ py: 2.5, px: 2 }}>
        <Typography
          variant="body1"
          className="vulnerability-table__package"
          sx={{ fontSize: '0.875rem', fontWeight: 500 }}
        >
          {vulnerability.packageName}
        </Typography>
      </TableCell>

      <TableCell sx={{ py: 2.5, px: 2 }}>
        <Typography variant="body1" color="text.secondary" sx={{ fontSize: '0.875rem' }}>
          {vulnerability.packageVersion || 'N/A'}
        </Typography>
      </TableCell>

      <TableCell sx={{ py: 2.5, px: 2 }}>
        <Typography variant="body1" color="text.secondary" sx={{ fontSize: '0.875rem' }}>
          {formatDate(vulnerability.published)}
        </Typography>
      </TableCell>

      <TableCell sx={{ py: 2.5, px: 2 }}>
        <Typography
          variant="body1"
          color="text.secondary"
          sx={{
            fontSize: '0.875rem',
            textTransform: 'capitalize',
          }}
        >
          {vulnerability.status || 'N/A'}
        </Typography>
      </TableCell>
    </TableRow>
  );
};
